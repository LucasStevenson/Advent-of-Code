import sys, re
import numpy as np
infile = sys.argv[1] if len(sys.argv) > 1 else "input.txt"

with open(infile) as f:
    Y, X = (103,101)
    A = np.zeros((Y, X))
    inputs = []
    while line := f.readline().strip():
        x, y, dx, dy = tuple(map(int, re.findall(r"(\-?\d+)", line)))
        inputs.append((x, y, dx, dy))
    N = 1
    while True:
        for (x,y,dx,dy) in inputs:
            fx, fy = (x+dx*N) % X, (y+dy*N) % Y
            A[fy, fx] = 1
        A = A.astype(int).astype(str).tolist()
        for r in A:
            # The general idea is that an image of a Xmas tree should have multiple consecutively marked spots
            # The number of 1's I chose to check for is arbitrary, but it should be enough to filter out the noisy images
            if "11111111" in "".join(r):
                print(N)
                sys.exit()
        N += 1
        A = np.zeros((Y,X))

"""
N=7672
.............................#........................................#.........................#....
#............#...................................#.............#.....................#...............
...................#...............#.................................................................
.......................................................................................#.............
........................................................................#............................
.....#.................................................................................#.............
.....................................................................................................
............................#...................#....................................................
.....................................................................................#...............
.....................................................................................................
............#....#...........................................................................#.......
..........................................................#.#.....................#..................
......................................................................#....................#.........
...............................#.....................................................................
..........................................................#..........................................
......................................#..........#............................#......................
................#....................................................................................
.............#....................................#..................................................
...............................................................................................#.....
..............................#..............................................#..........#..........#.
.................................................#....#..............................................
.#...................................................................................................
.....................................................................................................
#....................................................................................................
......................................###############################................................
......................................#.............................#................................
......................................#.............................#................................
..##..................................#.............................#................................
......................................#.............................#................................
.....#................................#..............#..............#................................
......................................#.............###.............#.....#..........................
......................................#............#####............#...#............................
......................................#...........#######...........#......#.........................
......................................#..........#########..........#................................
......................................#............#####............#................................
.........................#............#...........#######...........#.#..................#...........
#...................................#.#..........#########..........#......................#.#.......
......................................#.........###########.........#................................
......................................#........#############........#................................
...........#..........................#..........#########..........#.....#.........#.............#..
......................................#.........###########.........#................................
......................................#........#############........#..............#.................
......................................#.......###############.......#.#..............................
.........................#............#......#################......#................................
......................................#........#############........#.............#..................
...................................#..#.......###############.......#...#............................
......................................#......#################......#.......##.......................
......................................#.....###################.....#................................
........................#.............#....#####################....#.............................#..
..........#..................#........#.............###.............#................................
.#....................................#.............###.............#........................#.......
.......#..............................#.............###.............#..............#.................
......................................#.............................#................................
..............................#.......#.............................#................................
......................................#.............................#.#..............................
....................................#.#.............................#.......#........................
#.....................................###############################................................
.....................................................................................................
.......................................................##.......................................#....
...#.................................................................................................
.......................#...................#............................#......#.....................
.....................................................................................................
....#.......................................................#.........#.............................#
.......#............................#............................#............#......................
.....................................................................................................
..............#....................................#.................................................
...............................................#...................................#.................
.............................................................#.......................................
...........................#..........................................................#..............
.....#..........................................#..#................................................#
....#................................................................................................
.....................................................................................................
.....................................................................................................
...........................................................#............##...#.......................
...................................#..............................................#..................
.....................................................................................................
.....................................................................................................
....................................................................................................#
.....................................................................................................
......................................#..............................................................
.....................................................................................................
...............................................#............#........................................
.##..................................................................#...............................
.....................................................................................................
..........................................................................................#..........
...................#......#................#.........................................................
....................#.....................................................#..........................
.....................................................................................................
........#............#.........#.....................................................................
..........................................#...............................#..........................
.....................................................................................................
.....................................#...............................................................
.....................................................................................................
.............#.....#.................................................................................
...............................#........................................................#............
............................#........................................................................
.....................................................................................................
..........#..........................................................................................
................................#...................................#................................
.................#...#...............................................................................
.........................................................................................#...........
.....................................................................................................
......................#.........................#...#................................................
"""
